<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <title>게시판 + 로그인 (Vue)</title>
    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <!-- Axios CDN -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f5f5;
        }

        header {
            background: #2c3e50;
            color: white;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header h1 {
            margin: 0;
            font-size: 20px;
        }

        .login-box {
            display: flex;
            gap: 8px;
            align-items: center;
            font-size: 14px;
        }

        .login-box input {
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 13px;
        }

        .login-box button {
            padding: 4px 10px;
            border: none;
            border-radius: 4px;
            background: #3498db;
            color: white;
            cursor: pointer;
            font-size: 13px;
        }

        .login-box button:hover {
            opacity: 0.9;
        }

        main {
            padding: 24px;
            max-width: 900px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.06);
            padding: 16px 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
            font-size: 14px;
        }

        thead {
            background: #fafafa;
        }

        th,
        td {
            border: 1px solid #e0e0e0;
            padding: 8px;
            text-align: left;
        }

        th {
            font-weight: 600;
        }

        tbody tr:hover {
            background: #f9f9f9;
        }

        .pagination {
            margin-top: 12px;
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            align-items: center;
            font-size: 13px;
        }

        .pagination button {
            padding: 4px 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
            background: white;
            cursor: pointer;
        }

        .pagination button:disabled {
            opacity: 0.4;
            cursor: default;
        }

        .message {
            margin-top: 8px;
            font-size: 13px;
            color: #e74c3c;
        }
    </style>
</head>

<body>
    <div id="app">
        <!-- 상단 헤더 -->
        <header>
            <h1>게시판 데모</h1>

            <!-- 로그인 영역 -->
            <div class="login-box" v-if="!isLoggedIn">
                <span>로그인</span>
                <input type="text" placeholder="ID" v-model="loginForm.id" />
                <input type="password" placeholder="비밀번호" v-model="loginForm.password" />
                <button @click="doLogin">로그인</button>
            </div>

            <!-- 로그인 후 영역 -->
            <div class="login-box" v-else>
                <span><strong>{{ loginUserId }}</strong> 님 로그인 중</span>
                <button @click="doLogout">로그아웃</button>
            </div>
        </header>

        <!-- 메인 영역 -->
        <main>
            <div class="card">
                <h2>게시판 목록</h2>

                <!-- 오류/안내 메시지 -->
                <div class="message" v-if="errorMessage">
                    {{ errorMessage }}
                </div>

                <!-- 게시판 테이블 -->
                <table>
                    <thead>
                        <tr>
                            <th style="width: 80px;">번호</th>
                            <th>제목</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-if="boardList.length === 0">
                            <td colspan="2" style="text-align:center;">게시글이 없습니다.</td>
                        </tr>
                        <tr v-for="item in boardList" :key="item.idx">
                            <td>{{ item.idx }}</td>
                            <td>{{ item.title }}</td>
                        </tr>
                    </tbody>
                </table>

                <!-- 페이징 -->
                <div class="pagination">
                    <button @click="prevPage" :disabled="page === 1">이전</button>
                    <span>페이지 {{ page }}</span>
                    <button @click="nextPage" :disabled="!hasNextPage">다음</button>
                </div>
            </div>
        </main>
    </div>

    <script>
        const { createApp, ref, onMounted, computed } = Vue;

        createApp({
            setup() {
                // ------------------------
                // 1. 기본 설정
                // ------------------------
                // 백엔드 API 주소 (필요하면 여기만 바꾸면 됨)
                const API_BASE = "http://java.localhost";
                // 예: nginx 뒤에 있으면 http://your-domain.com 이런 식으로

                // ------------------------
                // 2. 로그인 상태
                // ------------------------
                const loginForm = ref({
                    id: "",
                    password: ""
                });

                const loginUserId = ref(null);  // 로그인한 사용자 ID 저장
                const isLoggedIn = computed(() => loginUserId.value !== null);

                const errorMessage = ref("");

                // ------------------------
                // 3. 게시판 목록 상태
                // ------------------------
                const boardList = ref([]);
                const page = ref(1);
                const size = ref(10);
                const hasNextPage = ref(true); // 다음 페이지 존재 여부 (간단 로직)

                // ------------------------
                // 4. API 호출 함수들
                // ------------------------
                // 로그인
                const doLogin = async () => {
                    errorMessage.value = "";
                    if (!loginForm.value.id || !loginForm.value.password) {
                        errorMessage.value = "ID와 비밀번호를 입력하세요.";
                        return;
                    }

                    try {
                        const res = await axios.post(
                            API_BASE + "/api/user/login",
                            {
                                id: loginForm.value.id,
                                password: loginForm.value.password
                            }
                        );
                        // 여기서는 "로그인 성공"이라고 가정하고 ID만 저장
                        // 실제로는 res.data 안에 success, token 등을 넣어서 처리하면 좋음
                        loginUserId.value = loginForm.value.id;
                        loginForm.value.password = "";
                    } catch (err) {
                        console.error(err);
                        errorMessage.value = "로그인에 실패했습니다.";
                    }
                };

                const doLogout = () => {
                    loginUserId.value = null;
                };

                // 게시판 목록 조회
                const fetchBoardList = async () => {
                    errorMessage.value = "";
                    try {
                        const res = await axios.get(
                            API_BASE + "/api/board",
                            {
                                params: {
                                    page: page.value,
                                    size: size.value
                                }
                            }
                        );

                        // ⚠️ 여기서는 "배열이 바로 온다"고 가정
                        // 예: [ { idx:1, title:"제목", content:"..." }, ... ]
                        // 만약 { list: [...], totalCount: ... } 구조면
                        // boardList.value = res.data.list 같이 수정하면 됨
                        boardList.value = res.data;

                        // 간단한 "다음 페이지 여부" 계산:
                        // 이번에 받아온 개수가 size보다 작으면 마지막 페이지라고 가정
                        hasNextPage.value = boardList.value.length === size.value;
                    } catch (err) {
                        console.error(err);
                        errorMessage.value = "게시판 목록을 불러오지 못했습니다.";
                    }
                };

                const prevPage = () => {
                    if (page.value === 1) return;
                    page.value -= 1;
                    fetchBoardList();
                };

                const nextPage = () => {
                    if (!hasNextPage.value) return;
                    page.value += 1;
                    fetchBoardList();
                };

                // ------------------------
                // 5. 초기 로딩 시 게시판 불러오기
                // ------------------------
                onMounted(() => {
                    fetchBoardList();
                });

                // ------------------------
                // 6. 템플릿에 바인딩할 것들 리턴
                // ------------------------
                return {
                    loginForm,
                    loginUserId,
                    isLoggedIn,
                    errorMessage,
                    boardList,
                    page,
                    hasNextPage,
                    doLogin,
                    doLogout,
                    prevPage,
                    nextPage
                };
            }
        }).mount("#app");
    </script>
</body>

</html>